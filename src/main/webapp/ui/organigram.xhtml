<ui:composition
  xmlns="http://www.w3.org/1999/xhtml"
  xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
  xmlns:h="http://xmlns.jcp.org/jsf/html"
  xmlns:f="http://xmlns.jcp.org/jsf/core"
  xmlns:p="http://primefaces.org/ui"
  template="/WEB-INF/template.xhtml"
>
  <ui:define name="title">
    Organization  <span class="subitem"> configuration</span>
  </ui:define>

  <ui:define name="description">
     You can have a organizational chart to create a record of workflow on reporting manager allocation 
     Follow the steps given below to know how to create a scheduler.
  </ui:define>

  <ui:param name="documentationLink" value="/components/schedule" />
  <ui:param name="widgetLink" value="Schedule-1" />

  <ui:define name="implementation">
    <h:form id="form">
      <p:growl id="messages" showDetail="true" />

      <div class="card crud-demo">
        <h5>Organization Details</h5>
        <p:toolbar>
          <p:toolbarGroup>
              <p:commandButton value="New" icon="pi pi-plus" actionListener="#{organigramController.openNew}"
                  update=":dialogs:manage-product-content" oncomplete="PF('manageProductDialog').show()"
                  styleClass="ui-button-success" style="margin-right: .5rem">
                  <p:resetInput target=":dialogs:manage-product-content" />
              </p:commandButton>
             
          </p:toolbarGroup>
          <p:toolbarGroup align="right">
              <p:fileUpload mode="simple" skinSimple="true" label="Import" chooseIcon="pi pi-download" />
              <p:commandButton value="Export" icon="pi pi-upload" styleClass="ui-button-help" ajax="false">
                  <p:dataExporter type="pdf" target="dt-products" fileName="products" />
              </p:commandButton>
          </p:toolbarGroup>
      </p:toolbar>

      <p:organigram id="organigram"
                              widgetVar="organigram"
                              value="#{organigramController.rootNode}"
                              var="node"
                              leafNodeConnectorHeight="#{organigramController.leafNodeConnectorHeight}"
                              autoScrollToSelection="#{organigramController.autoScrollToSelection}"
                              zoom="#{organigramController.zoom}"
                              selection="#{organigramController.selection}"
                              style="width: 1500px">

                        <p:ajax event="dragdrop" process="@this" update="@form:messages"
                            listener="#{organigramController.nodeDragDropListener}"/>
                        <p:ajax event="select" process="@this" update="@form:messages"
                            listener="#{organigramController.nodeSelectListener}"/>
                        <p:ajax event="contextmenu" process="@this"/>
                        <p:ajax event="collapse" process="@this" update="@form:messages"
                            listener="#{organigramController.nodeCollapseListener}"/>
                        <p:ajax event="expand" process="@this" update="@form:messages"
                            listener="#{organigramController.nodeExpandListener}"/>

                        <p:organigramNode>
                        <h:outputText value="#{node.data}"/>
                        </p:organigramNode>

                        <p:organigramNode type="root"
                                      style="border-radius: 10px;">
                        <h:outputText value="#{node.data}"/>
                        </p:organigramNode>

                        <p:organigramNode type="division"
                                      styleClass="division"
                                      icon="pi pi-briefcase"
                                      iconPos="left">
                        <h:outputText value="#{node.data}"/>
                        </p:organigramNode>

                        <p:organigramNode type="employee"
                                      styleClass="employee"
                                      icon="pi pi-user">
                        <h:outputText value="#{node.data}"/>
                        </p:organigramNode>
                        </p:organigram>

      
    </div>
  </h:form>

  <h:form id="dialogs">
      <p:dialog header="Organization  Details" showEffect="fade" modal="true" widgetVar="manageProductDialog"
          responsive="true">
        
              <p:outputPanel id="manage-product-content" class="ui-fluid">
                  <p:outputPanel rendered="#{not empty organigramController.selectedOrganigram}">   
            <div class="field">               
                      <p:outputLabel for="type"></p:outputLabel>
                      <p:selectOneButton value="#{organigramController.type}" id="type">
                          <f:selectItem itemLabel="Employee" itemValue="emplopyee"/>
                          <f:selectItem itemLabel="Manager" itemValue="manager"/>           
                      </p:selectOneButton>
            </div>
           <div class="field">               
                    <p:outputLabel for="department">Department</p:outputLabel>
                    <p:selectOneMenu value="#{organigramController.department}" id="department" 
                          autoWidth="false" editable="false" maxlength="10"
                          filter="true" filterMatchMode="startsWith">
                          <p:ajax listener="#{organigramController.onDepartmentChange}" update="reportingManaget"/>
                          <f:selectItems value="#{organigramController.departments}" var="player"
                              itemLabel="#{player.departmentName}" itemValue="#{player.id}" />               
                </p:selectOneMenu>
          </div>
          <div class="field">
                    <p:outputLabel for="reportingManaget">Reporting Manager</p:outputLabel>                    
                    <p:selectOneMenu value="#{organigramController.reportingManaget}" id="reportingManaget" 
                          autoWidth="false" editable="false"
                          filter="true" filterMatchMode="startsWith">
                          <p:ajax listener="#{organigramController.onManagerChange}" update="reporties"/>
                          <f:selectItems value="#{organigramController.selectedEmployees}" var="player"
                              itemLabel="#{player.employeeName}" itemValue="#{player.employeeId}" />               
                </p:selectOneMenu>
             </div>    
             <div class="field">
              <p:outputLabel for="reporties">Reporties</p:outputLabel>  
              <p:selectCheckboxMenu id="reporties"
                              dynamic="true"
                              filter="true" filterMatchMode="startsWith"
                              label="Reporters"
                            
                              value="#{organigramController.reporties}">
                    <f:selectItems value="#{organigramController.reportiesEmployees}" var="player"
                              itemLabel="#{player.employeeName}" itemValue="#{player.employeeId}" />      

            <f:facet name="footer">
                <p:divider styleClass="mt-0" />
                <h:outputText value="#{organigramController.reportiesEmployees.size()} Reporters"
                              styleClass="py-1 block font-bold"/>
            </f:facet>
        </p:selectCheckboxMenu>
             </div>                             
                 
                 
              </p:outputPanel>
          </p:outputPanel>

          <f:facet name="footer">
              <p:commandButton value="Save" icon="pi pi-check" actionListener="#{organigramController.saveOnganization}"
               update="manage-product-content,:form:messages" process="manage-product-content @this" />

              <p:commandButton value="Cancel" icon="pi pi-times" onclick="PF('manageProductDialog').hide()"
                  class="ui-button-secondary" type="button" />
          </f:facet>
      </p:dialog>

     
      <p:confirmDialog global="true" showEffect="fade" width="300">
          <p:commandButton value="Yes" type="button" styleClass="ui-confirmdialog-yes" icon="pi pi-check" />
          <p:commandButton value="No" type="button" styleClass="ui-confirmdialog-no ui-button-secondary"
              icon="pi pi-times" />
      </p:confirmDialog>      
  
    </h:form>
  </ui:define>
</ui:composition>
